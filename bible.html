<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Search the Bible — A FAITH DRIVEN LIFE</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&family=Source+Serif+4:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
  <style>
    :root { --bg: #0a1628; --surface: #132238; --text: #f0f4f8; --muted: #94a3b8; --accent: #d4af37; }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: 'Outfit', sans-serif; background: var(--bg); color: var(--text); line-height: 1.7; min-height: 100vh; padding-top: 8rem; }
    .container { max-width: 720px; margin: 0 auto; padding: 0 1.5rem; }
    .site-nav { position: fixed; top: 0; left: 0; right: 0; z-index: 100; background: var(--bg); border-bottom: 1px solid rgba(255,255,255,0.08); padding: 1rem 1.5rem; min-height: 7rem; }
    .site-nav .nav-inner { max-width: 100%; width: 100%; margin: 0 auto; padding: 0 0.5rem; display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between; gap: 1rem; }
    .site-nav .site-name { display: flex; align-items: center; gap: 0.75rem; color: var(--text); text-decoration: none; font-weight: 700; flex-shrink: 0; }
    .site-nav .site-name:hover { color: var(--accent); }
    .site-nav .site-name-block { max-width: min(28em, 50vw); }
    .site-nav .site-tagline { font-size: 0.75rem; color: #00d4ff; line-height: 1.35; }
    .site-nav .site-logo { height: 5.5rem; width: auto; max-width: 280px; display: block; object-fit: contain; }
    .site-nav .nav-links { display: flex; flex-wrap: wrap; gap: 0.25rem 1.5rem; list-style: none; margin: 0; padding: 0; }
    .site-nav .nav-links a { color: #00d4ff; text-decoration: none; font-size: 0.95rem; font-weight: 500; }
    .site-nav .nav-links a:hover { color: var(--accent); }
    .visit-counter { font-size: 0.75rem; color: var(--muted); margin-left: auto; padding-left: 1rem; white-space: nowrap; }
    .visit-counter::before { content: 'Site visits: '; }
    @media (min-width: 768px) { .site-nav .site-logo { height: 6.5rem; max-width: 320px; } .site-nav .nav-links a { font-size: 1rem; } }
    section { padding: 3rem 0; }
    section h2 { font-family: 'Source Serif 4', serif; font-size: 1.5rem; font-weight: 600; margin: 0 0 1rem; color: var(--accent); }
    .bible-intro { color: var(--muted); font-size: 0.95rem; margin-bottom: 1.5rem; }
    .bible-form { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 2rem; }
    .bible-form input { flex: 1; min-width: 200px; padding: 0.6rem 1rem; font: inherit; background: var(--surface); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: var(--text); }
    .bible-form input:focus { outline: none; border-color: var(--accent); }
    .bible-form input::placeholder { color: var(--muted); }
    .bible-form button { padding: 0.6rem 1.25rem; font: inherit; font-weight: 600; background: var(--accent); color: var(--bg); border: none; border-radius: 8px; cursor: pointer; }
    .bible-form button:hover { opacity: 0.9; }
    .bible-result { background: var(--surface); border-radius: 10px; padding: 1.5rem 1.75rem; border: 1px solid rgba(255,255,255,0.06); margin-top: 1rem; }
    .bible-ref { font-weight: 600; color: var(--accent); margin-bottom: 0.75rem; font-size: 1rem; }
    .bible-text { font-size: 1.1rem; line-height: 1.8; }
    .bible-text .verse-num { color: var(--muted); font-size: 0.85em; font-weight: 400; }
    .bible-loading, .bible-error { color: var(--muted); padding: 1.5rem 0; }
    .bible-error { color: #f87171; }
    .bible-fallback a:hover { text-decoration: underline; }
    footer { padding: 2rem 0 3rem; border-top: 1px solid rgba(255,255,255,0.06); color: var(--muted); font-size: 0.9rem; }
    @media (max-width: 767px) {
      body { padding-top: 6.5rem; }
      .container { padding-left: 1rem; padding-right: 1rem; }
      .site-nav { padding: 0.75rem 1rem; min-height: 5.5rem; }
      .site-nav .nav-inner { gap: 0.5rem; }
      .site-nav .site-name-block { max-width: min(20em, 65vw); }
      .site-nav .site-tagline { font-size: 0.65rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
      .site-nav .site-logo { height: 4rem; max-width: 160px; }
      .site-nav .nav-links { gap: 0.15rem 0.5rem; }
      .site-nav .nav-links a { padding: 0.5rem 0.35rem; min-height: 2.75rem; display: inline-flex; align-items: center; font-size: 0.9rem; }
      section { padding: 2rem 0; }
      section h2 { font-size: 1.35rem; margin-bottom: 0.75rem; }
      .bible-form { flex-direction: column; gap: 0.5rem; margin-bottom: 1.5rem; }
      .bible-form input { min-width: 0; width: 100%; }
      .bible-form button { width: 100%; min-height: 2.75rem; }
      .bible-result { padding: 1.25rem 1rem; }
      .bible-text { font-size: 1rem; }
      footer { padding: 1.5rem 0 2rem; font-size: 0.85rem; }
    }
    @media (max-width: 380px) { .site-nav .site-tagline { -webkit-line-clamp: 1; } .site-nav .site-name-block { max-width: 12em; } .site-nav .nav-links a { font-size: 0.85rem; padding: 0.4rem 0.25rem; } }
  </style>
</head>
<body>
  <nav class="site-nav" aria-label="Main">
    <div class="nav-inner">
      <a href="index.html" class="site-name">
        <img src="logo.png" alt="A Faith Driven Life" class="site-logo" onerror="this.style.display='none'">
        <span class="site-name-block">
          <span class="site-tagline">Do not conform to the pattern of this world, but be transformed by the renewing of your mind. Then you will be able to test and approve what God's will is—his good, pleasing and perfect will. — Romans 12:2 (NIV)</span>
        </span>
      </a>
      <span class="visit-counter" id="visit-counter" aria-label="Total site visits">—</span>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="blogs.html">Blogs</a></li>
        <li><a href="audio.html">Audio</a></li>
        <li><a href="bible.html">Search the Bible</a></li>
        <li><a href="comments.html">Comments</a></li>
        <li><a href="prayer-requests.html">Prayer requests</a></li>
        <li><a href="testimonies.html">Testimonies</a></li>
      </ul>
    </div>
  </nav>

  <div class="container">
    <section id="bible">
      <h2>Search the Bible</h2>
      <p class="bible-intro">Enter a verse (e.g. John 3:16) or a whole chapter (e.g. John 3, Psalm 23). The passage is displayed here on the page in the <strong>Berean Standard Bible (BSB)</strong>.</p>
      <form class="bible-form" id="bible-form">
        <input type="text" id="verse-input" placeholder="e.g. John 3:16" required autocomplete="off">
        <button type="submit">Search</button>
      </form>
      <div id="bible-loading" class="bible-loading" style="display: none;">Loading…</div>
      <div id="bible-error" class="bible-error" style="display: none;"></div>
      <p id="bible-error-niv" style="display: none; margin-top: 0.5rem; font-size: 0.9rem;"><a id="bible-gateway-link-fail" href="#" target="_blank" rel="noopener" style="color: var(--accent);">Open in NIV (Bible Gateway)</a></p>
      <div id="bible-result" class="bible-result" style="display: none;">
        <div class="bible-ref" id="bible-ref"></div>
        <div class="bible-text" id="bible-text"></div>
        <p class="bible-niv-link" style="margin: 1rem 0 0; font-size: 0.9rem; color: var(--muted);">Need NIV? <a id="bible-gateway-link" href="https://www.biblegateway.com/passage/?version=NIV" target="_blank" rel="noopener" style="color: var(--accent);">Open this passage on Bible Gateway</a></p>
      </div>
    </section>
    <footer><p>A FAITH DRIVEN LIFE</p></footer>
  </div>

  <script>
    (function () {
      var form = document.getElementById('bible-form');
      var input = document.getElementById('verse-input');
      var loadingEl = document.getElementById('bible-loading');
      var errorEl = document.getElementById('bible-error');
      var resultEl = document.getElementById('bible-result');
      var refEl = document.getElementById('bible-ref');
      var textEl = document.getElementById('bible-text');
      var gatewayLink = document.getElementById('bible-gateway-link');
      var TIMEOUT_MS = 6000;
      var bookToOsis = { 'Genesis': 'GEN', 'Exodus': 'EXO', 'Leviticus': 'LEV', 'Numbers': 'NUM', 'Deuteronomy': 'DEU', 'Joshua': 'JOS', 'Judges': 'JDG', 'Ruth': 'RUT', '1 Samuel': '1SA', '2 Samuel': '2SA', '1 Kings': '1KI', '2 Kings': '2KI', '1 Chronicles': '1CH', '2 Chronicles': '2CH', 'Ezra': 'EZR', 'Nehemiah': 'NEH', 'Esther': 'EST', 'Job': 'JOB', 'Psalm': 'PSA', 'Psalms': 'PSA', 'Proverbs': 'PRO', 'Ecclesiastes': 'ECC', 'Song of Solomon': 'SNG', 'Song of Songs': 'SNG', 'Isaiah': 'ISA', 'Jeremiah': 'JER', 'Lamentations': 'LAM', 'Ezekiel': 'EZK', 'Daniel': 'DAN', 'Hosea': 'HOS', 'Joel': 'JOL', 'Amos': 'AMO', 'Obadiah': 'OBA', 'Jonah': 'JON', 'Micah': 'MIC', 'Nahum': 'NAH', 'Habakkuk': 'HAB', 'Zephaniah': 'ZEP', 'Haggai': 'HAG', 'Zechariah': 'ZEC', 'Malachi': 'MAL', 'Matthew': 'MAT', 'Mark': 'MRK', 'Luke': 'LUK', 'John': 'JHN', 'Acts': 'ACT', 'Romans': 'ROM', '1 Corinthians': '1CO', '2 Corinthians': '2CO', 'Galatians': 'GAL', 'Ephesians': 'EPH', 'Philippians': 'PHP', 'Colossians': 'COL', '1 Thessalonians': '1TH', '2 Thessalonians': '2TH', '1 Timothy': '1TI', '2 Timothy': '2TI', 'Titus': 'TIT', 'Philemon': 'PHM', 'Hebrews': 'HEB', 'James': 'JAS', '1 Peter': '1PE', '2 Peter': '2PE', '1 John': '1JN', '2 John': '2JN', '3 John': '3JN', 'Jude': 'JUD', 'Revelation': 'REV' };
      var abbrToBook = { gen: 'Genesis', ex: 'Exodus', lev: 'Leviticus', num: 'Numbers', deut: 'Deuteronomy', josh: 'Joshua', judg: 'Judges', ruth: 'Ruth', '1 sam': '1 Samuel', '2 sam': '2 Samuel', '1 kings': '1 Kings', '2 kings': '2 Kings', '1 chron': '1 Chronicles', '2 chron': '2 Chronicles', ezra: 'Ezra', neh: 'Nehemiah', est: 'Esther', job: 'Job', ps: 'Psalm', psalm: 'Psalm', psalms: 'Psalms', prov: 'Proverbs', eccl: 'Ecclesiastes', song: 'Song of Solomon', isa: 'Isaiah', jer: 'Jeremiah', lam: 'Lamentations', ezek: 'Ezekiel', dan: 'Daniel', hos: 'Hosea', joel: 'Joel', amos: 'Amos', obad: 'Obadiah', jonah: 'Jonah', mic: 'Micah', nah: 'Nahum', hab: 'Habakkuk', zeph: 'Zephaniah', hag: 'Haggai', zech: 'Zechariah', mal: 'Malachi', matt: 'Matthew', mk: 'Mark', lk: 'Luke', jn: 'John', jhn: 'John', acts: 'Acts', rom: 'Romans', '1 cor': '1 Corinthians', '2 cor': '2 Corinthians', gal: 'Galatians', eph: 'Ephesians', phil: 'Philippians', col: 'Colossians', '1 thess': '1 Thessalonians', '2 thess': '2 Thessalonians', '1 tim': '1 Timothy', '2 tim': '2 Timothy', titus: 'Titus', philem: 'Philemon', heb: 'Hebrews', jas: 'James', '1 pet': '1 Peter', '2 pet': '2 Peter', '1 jn': '1 John', '2 jn': '2 John', '3 jn': '3 John', jude: 'Jude', rev: 'Revelation' };
      function parseRef(ref) {
        var s = ref.trim();
        var m = s.match(/^(\d?\s*\w+(?:\s+\w+)?)\s+(\d+)(?::(\d+)(?:-(\d+))?)?$/i);
        if (!m) return null;
        var bookPart = m[1].replace(/\s+/g, ' ').trim().toLowerCase();
        var book = abbrToBook[bookPart] || (m[1].trim().replace(/\b\w/g, function (c) { return c.toUpperCase(); }));
        var ch = parseInt(m[2], 10);
        var wholeChapter = !m[3];
        var v1 = m[3] ? parseInt(m[3], 10) : 1;
        var v2 = m[4] ? parseInt(m[4], 10) : (wholeChapter ? 999 : v1);
        var bookId = bookToOsis[book];
        if (!bookId) return null;
        return { book: book, bookId: bookId, chapter: ch, verseStart: v1, verseEnd: v2, wholeChapter: wholeChapter };
      }
      function verseContentToText(content) {
        if (!content || !content.length) return '';
        return content.map(function (c) {
          if (typeof c === 'string') return c;
          if (c && typeof c === 'object' && c.text) return c.text;
          return '';
        }).join('').trim();
      }
      form.addEventListener('submit', function (e) {
        e.preventDefault();
        var ref = input.value.trim();
        if (!ref) return;
        var parsed = parseRef(ref);
        if (!parsed) {
          errorEl.textContent = 'Use a reference like John 3:16 or Psalm 23:1.';
          errorEl.style.display = 'block';
          resultEl.style.display = 'none';
          loadingEl.style.display = 'none';
          return;
        }
        loadingEl.style.display = 'block';
        errorEl.style.display = 'none';
        document.getElementById('bible-error-niv').style.display = 'none';
        resultEl.style.display = 'none';
        var path = parsed.book + ' ' + parsed.chapter + (parsed.wholeChapter ? '' : ':' + parsed.verseStart + (parsed.verseEnd > parsed.verseStart ? '-' + parsed.verseEnd : ''));
        var apiUrl = 'https://bible.helloao.org/api/BSB/' + parsed.bookId + '/' + parsed.chapter + '.json';
        var proxies = ['https://api.allorigins.win/raw?url=', 'https://corsproxy.io/?'];
        function tryProxy(i) {
          if (i >= proxies.length) {
            loadingEl.style.display = 'none';
            errorEl.textContent = 'Could not load verse. Try again or open in NIV below.';
            errorEl.style.display = 'block';
            document.getElementById('bible-gateway-link-fail').href = 'https://www.biblegateway.com/passage/?search=' + encodeURIComponent(path) + '&version=NIV';
            document.getElementById('bible-error-niv').style.display = 'block';
            return;
          }
          var controller = new AbortController();
          var t = setTimeout(function () { controller.abort(); }, TIMEOUT_MS);
          fetch(proxies[i] + encodeURIComponent(apiUrl), { signal: controller.signal })
            .then(function (res) {
              clearTimeout(t);
              if (!res.ok) throw new Error();
              return res.json();
            })
            .then(function (data) {
              clearTimeout(t);
              var content = data.chapter && data.chapter.content;
              if (!content || !content.length) throw new Error();
              var verses = [];
              content.forEach(function (item) {
                if (item.type !== 'verse' || item.number == null) return;
                var n = parseInt(item.number, 10);
                if (n >= parsed.verseStart && n <= parsed.verseEnd) verses.push({ num: n, text: verseContentToText(item.content) });
              });
              if (verses.length === 0) throw new Error();
              refEl.textContent = path + ' (BSB)';
              textEl.innerHTML = verses.map(function (v) {
                return '<span class="verse-num">' + v.num + '</span> ' + (v.text || '');
              }).join(' ');
              gatewayLink.href = 'https://www.biblegateway.com/passage/?search=' + encodeURIComponent(path) + '&version=NIV';
              resultEl.style.display = 'block';
              loadingEl.style.display = 'none';
              resultEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
            })
            .catch(function () {
              clearTimeout(t);
              tryProxy(i + 1);
            });
        }
        tryProxy(0);
      });
    })();
  </script>
  <script src="visit-counter.js"></script>
</body>
</html>
